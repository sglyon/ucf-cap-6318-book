{"kind":"Notebook","sha256":"c4cccf83a215972fba02c3c6d6c737f177cf3ccf7b113c0e9f7995c4088039cf","slug":"rl-06-dqn-intro","location":"/reinforcement_learning/rl.06_dqn_intro.ipynb","dependencies":[],"frontmatter":{"title":"Reinforcement Learning â€“ Intro to Deep Q Networks","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"cap-6318","language":"python"},"authors":[{"nameParsed":{"literal":"Spencer Lyon","given":"Spencer","family":"Lyon"},"name":"Spencer Lyon","orcid":"0009-0001-6461-885X","email":"spencer.lyon@ucf.edu","affiliations":["University of Central Florida","Valorum Data"],"id":"contributors-myst-generated-uid-0","corresponding":true}],"affiliations":[{"id":"University of Central Florida","name":"University of Central Florida"},{"id":"Valorum Data","name":"Valorum Data"}],"exports":[{"format":"ipynb","filename":"rl.06_dqn_intro.ipynb","url":"/build/rl.06_dqn_intro-a4f2cf2d5643a708b0cef3ae8d6c60fb.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Prerequisites","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"t2UqRh0Pvm"}],"key":"EUYq1g23MK"}],"key":"pfiScBjLCk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Tensorflow, keras","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YHaUPqIpQS"}],"key":"tuwE4si4ll"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Reinforcement Learning -- Q learning with continuous state spaces","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"GIXEhSZ7Qy"}],"key":"LddCWchT4Q"}],"key":"W7J48XNWLq"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Outcomes","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"yRQve6j1aL"}],"key":"Q079Zcn37i"}],"key":"zf2CP0BXie"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Be able to use tensorflow to use a neural network to approximate ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"L5r4IhyqAF"},{"type":"inlineMath","value":"Q(s, a)","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">Q(s, a)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">Q</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mclose\">)</span></span></span></span>","key":"CEcDpDo5db"},{"type":"text","value":" for continuous spaces ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"qsxhVW5D2T"},{"type":"inlineMath","value":"\\mathcal{S}","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">S</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{S}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathcal\" style=\"margin-right:0.075em;\">S</span></span></span></span>","key":"JDYKVY4sig"}],"key":"SiATq9KfI6"}],"key":"xvAUSeumm7"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"strong","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"References","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"habkngvkuY"}],"key":"lWgHMJtTCG"}],"key":"fyfSH6Sc69"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"Barto & Sutton book (online by authors ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"GyCElpBnKa"},{"type":"link","url":"http://incompleteideas.net/book/the-book.html","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"p4Ghz1R5SV"}],"urlSource":"http://incompleteideas.net/book/the-book.html","key":"RlVlYfr5cU"},{"type":"text","value":") chapters 9-11","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"talJbi0xOQ"}],"key":"E3NfUvi5J3"}],"key":"h0Ie612RfJ"}],"visibility":"show","key":"l9qZeZvWQF"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"from collections import deque\nimport random\nfrom typing import List\n\nimport keras\nimport gymnasium as gym\nimport tensorflow as tf\n\nimport numpy as np","key":"Tzc9qb0ttH"},{"type":"output","id":"8syPqyBwMD5Bf1Xc4L7FY","data":[],"key":"JPAFKmVeNN"}],"key":"ojMWKxXzOW"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Review: CartPole","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MaAMKPrCWx"}],"identifier":"review-cartpole","label":"Review: CartPole","html_id":"review-cartpole","implicit":true,"key":"VDIXLMS06f"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"We previously studied the cart pole problem:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"g5a3Ayj3I8"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Pole fastened to a cart, but can freely rotate","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"vmmUoPIytk"}],"key":"QgHf8MRjl1"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Pole starts vertical, but with some angular velocity","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oITdPCmdt2"}],"key":"F3yID5ORqu"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Goal: move cart left and right to keep pole vertical","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Q1XmUhEajp"}],"key":"mfPaqUA3Ue"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"inlineMath","value":"\\mathcal{S} = \\{\\text{ cart position}, \\text{cart velocity}, \\text{ pole angle}, \\text{ pole angular velocity} \\} \\subset \\mathbb{R}^4","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">S</mi><mo>=</mo><mo stretchy=\"false\">{</mo><mtext>Â cartÂ position</mtext><mo separator=\"true\">,</mo><mtext>cartÂ velocity</mtext><mo separator=\"true\">,</mo><mtext>Â poleÂ angle</mtext><mo separator=\"true\">,</mo><mtext>Â poleÂ angularÂ velocity</mtext><mo stretchy=\"false\">}</mo><mo>âŠ‚</mo><msup><mi mathvariant=\"double-struck\">R</mi><mn>4</mn></msup></mrow><annotation encoding=\"application/x-tex\">\\mathcal{S} = \\{\\text{ cart position}, \\text{cart velocity}, \\text{ pole angle}, \\text{ pole angular velocity} \\} \\subset \\mathbb{R}^4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathcal\" style=\"margin-right:0.075em;\">S</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord\">Â cartÂ position</span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">cartÂ velocity</span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">Â poleÂ angle</span></span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord text\"><span class=\"mord\">Â poleÂ angularÂ velocity</span></span><span class=\"mclose\">}</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">âŠ‚</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span>","key":"cPYMaPvDWK"}],"key":"sGNdYuTPhs"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"inlineMath","value":"\\mathcal{A}(s) = \\{\\text{ left, right }\\}\\; \\forall s","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">A</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo stretchy=\"false\">{</mo><mtext>Â left,Â rightÂ </mtext><mo stretchy=\"false\">}</mo><mtext>â€…â€Š</mtext><mi mathvariant=\"normal\">âˆ€</mi><mi>s</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{A}(s) = \\{\\text{ left, right }\\}\\; \\forall s</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathcal\">A</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">{</span><span class=\"mord text\"><span class=\"mord\">Â left,Â rightÂ </span></span><span class=\"mclose\">}</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mord\">âˆ€</span><span class=\"mord mathnormal\">s</span></span></span></span>","key":"tMQPUwPPJM"}],"key":"ZwDj9v08Uv"}],"key":"ceqB3kiLjd"}],"key":"UAJguVS56N"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Need ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"hXd04eljzD"},{"type":"inlineMath","value":"Q","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span>","key":"YJQi1M1Loc"},{"type":"text","value":" to generalize between observations from continuous ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"wEOdEJXgT7"},{"type":"inlineMath","value":"\\mathcal{S}","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"script\">S</mi></mrow><annotation encoding=\"application/x-tex\">\\mathcal{S}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6833em;\"></span><span class=\"mord mathcal\" style=\"margin-right:0.075em;\">S</span></span></span></span>","key":"J2TIS8r39h"}],"key":"u3p7xcpln9"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Used complete polynomial to represent ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"nOB3coQ664"},{"type":"inlineMath","value":"Q","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span>","key":"D17UUEbsyZ"},{"type":"text","value":" and obtained about 120/200 tiem steps (random 30/120)","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"UEcdmvXMJw"}],"key":"qVazwhmV3Q"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Need more flexible method for approximating ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"SZQJ6urNJl"},{"type":"inlineMath","value":"Q","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span>","key":"mGHwQuq9ZA"},{"type":"text","value":"...","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"C5Qg4UuG9C"}],"key":"WOmU7hfY9G"}],"key":"ADleyBUtt3"}],"visibility":"show","key":"XRscWzj8gm"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"subslide"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Objective: DQN","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fFXHZXQ0bT"}],"identifier":"objective-dqn","label":"Objective: DQN","html_id":"objective-dqn","implicit":true,"key":"Nm22SPQGgY"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The objective for this lecture will be to use a MLP for approximating ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pUq1rjN2bw"},{"type":"inlineMath","value":"Q","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi></mrow><annotation encoding=\"application/x-tex\">Q</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8778em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">Q</span></span></span></span>","key":"BjMR9UNgQ6"}],"key":"aqddQGgIt3"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"A few key concepts:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Qs0NYRSFoM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Will represent ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"RKw8OLJ4Zv"},{"type":"inlineMath","value":"Q(s): \\mathcal{S} -> \\mathbb{R}^{|\\mathcal{A}|}","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Q</mi><mo stretchy=\"false\">(</mo><mi>s</mi><mo stretchy=\"false\">)</mo><mo>:</mo><mi mathvariant=\"script\">S</mi><mo>âˆ’</mo><mo>&gt;</mo><msup><mi mathvariant=\"double-struck\">R</mi><mrow><mi mathvariant=\"normal\">âˆ£</mi><mi mathvariant=\"script\">A</mi><mi mathvariant=\"normal\">âˆ£</mi></mrow></msup></mrow><annotation encoding=\"application/x-tex\">Q(s): \\mathcal{S} -&gt; \\mathbb{R}^{|\\mathcal{A}|}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">Q</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">:</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathcal\" style=\"margin-right:0.075em;\">S</span><span class=\"mord\">âˆ’</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">&gt;</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.888em;\"></span><span class=\"mord\"><span class=\"mord mathbb\">R</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.888em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">âˆ£</span><span class=\"mord mathcal mtight\">A</span><span class=\"mord mtight\">âˆ£</span></span></span></span></span></span></span></span></span></span></span></span>","key":"UtUQvMkQc9"}],"key":"WbVRPR01VT"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"To support mini-batch training (and other reasons weâ€™ll learn about in another lecture ğŸ˜‰) we will use ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"s3B1P82Cia"},{"type":"emphasis","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"experience replay","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"TV7hqQ5QOz"}],"key":"Ozkj929tbK"}],"key":"AiUJTLecY1"}],"key":"hK1PN35bNQ"}],"key":"IdcUkmHhPV"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Experience replay:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"zIDk3MsGoh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Store ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"AdF86nS0ma"},{"type":"inlineMath","value":"(s, a, r, s')","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>s</mi><mo separator=\"true\">,</mo><mi>a</mi><mo separator=\"true\">,</mo><mi>r</mi><mo separator=\"true\">,</mo><msup><mi>s</mi><mo mathvariant=\"normal\" lspace=\"0em\" rspace=\"0em\">â€²</mo></msup><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">(s, a, r, s&#x27;)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0019em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">s</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">s</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.7519em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">â€²</span></span></span></span></span></span></span></span></span><span class=\"mclose\">)</span></span></span></span>","key":"XkmRx2Y5jy"},{"type":"text","value":" transitions in a memory bank of fixed size","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"DtH0qZACf5"}],"key":"tJ9vEUd1yZ"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"As new transitions are added, â€œforgetâ€ oldest transitions if memory full","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"VlI0mrJ1Nk"}],"key":"rxpHqpDDg8"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"When training, sample randomly from current memory bank to form batch","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"wmrjdxybSu"}],"key":"sEC39TfpIS"}],"key":"rECNrhp5cw"}],"key":"hvUxQ32wGU"}],"key":"nS3mSaxfC5"}],"visibility":"show","key":"bNWKJQFfem"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"slide"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"DQN","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Uo0yIRUuDu"}],"identifier":"dqn","label":"DQN","html_id":"dqn","implicit":true,"key":"K4HFIODbVg"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Below we implement a Deep Q Network -- or a Q learning agent that uses a deep neural network for representing Q","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VHEsVqBiGg"}],"key":"Q94uM1hoiB"}],"key":"IAiwzT2y9d"}],"visibility":"show","key":"EXuP3Ngsx2"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"class DQN(object):\n    def __init__(\n            self,\n            environment,\n            optimizer=keras.optimizers.Adam(learning_rate=0.01),\n            loss=keras.losses.mean_squared_error,\n            hidden_layer_sizes: List[int] = [24, 24],\n            batch_size: int = 64,\n            memory_size: int = 5_000,\n            epsilon: float=0.9,\n            beta: float=0.5\n        ):\n        # check that environment is what we think it is\n        self.env = environment\n        self.Ns = self.env.observation_space.shape[0]\n\n        assert isinstance(self.env.action_space, gym.spaces.Discrete)\n        self.Na = self.env.action_space.n\n        self.A_s = np.arange(self.Na)\n\n        # set up Q function\n        self.Q = keras.Sequential(\n            [keras.layers.InputLayer((self.Ns,))] +\n            [keras.layers.Dense(n, activation=\"relu\") for n in hidden_layer_sizes] +\n            [keras.layers.Dense(\n                self.Na, activation=\"linear\",\n                kernel_initializer=tf.keras.initializers.RandomUniform(\n                    minval=-0.03, maxval=0.03\n                ),\n                bias_initializer=tf.keras.initializers.Constant(-0.2)\n            )]\n        )\n        self.Q.compile(loss=loss, optimizer=optimizer)\n        self.optimizer = optimizer\n        self.loss = loss\n\n        # set up memory\n        self.memory = deque(maxlen=memory_size)\n        self.batch_size = batch_size\n\n        # store hyper parameters\n        self.epsilon = epsilon\n        self.beta = beta\n\n    def get_greedy(self, s):\n        assert s.shape[0] == 1\n        Q_s = self.Q.predict(s, verbose=0)[0]\n        max_val = max(Q_s)\n        return random.choice(self.A_s[Q_s == max_val])\n\n    def remember(self, s, a, r, sp, done):\n        self.memory.append((s, a, r, sp, done))\n\n    def act(self, s):\n        if random.random() > self.epsilon:\n            return self.env.action_space.sample()\n        return self.get_greedy(s)\n\n    def learn_replay(self):\n        if len(self.memory) < self.batch_size:\n            # not enough memory yet...\n            return\n\n        # sample a batch\n        batch = random.sample(self.memory, self.batch_size)\n        sarsd = list(zip(*batch))\n\n        # reconstruct s, a, r, s' arrays\n        s = keras.ops.concatenate(sarsd[0], axis=0)\n        a = np.row_stack(sarsd[1])[:, 0]\n        r = np.row_stack(sarsd[2])[:, 0]\n        sp = np.concatenate(sarsd[3])\n\n        # compute temporal difference target using greedy policy\n        td_target = r + self.beta * tf.reduce_max(self.Q.predict(sp, verbose=0), axis=1)\n\n        # apply one hot encoding for easy application of `a` below\n        a_hot = keras.ops.one_hot(a, self.Na)\n\n        # compute the loss between current Q(s, a) and the targets\n        with tf.GradientTape() as tape:\n            Q_s = self.Q(s)\n            Q_sa = tf.reduce_sum(Q_s * a_hot, axis=1)\n            l = self.loss(td_target, Q_sa)\n\n        # backprop -- compute and then allow optimizer to apply gradients\n        grads = tape.gradient(l, self.Q.trainable_variables)\n        self.optimizer.apply_gradients(zip(grads, self.Q.trainable_variables))","key":"JjUxEahbSR"},{"type":"output","id":"bW8DL0a_Bmf_ThZ-QWQ-B","data":[],"key":"VeGXt9xx5K"}],"key":"d8giYXtxgq"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"subslide"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Setup","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PT7df64rS6"}],"identifier":"setup","label":"Setup","html_id":"setup","implicit":true,"key":"Tvek1y4cpC"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Below we set random seeds, create env, optimizer, and agent","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VSCh9HbNWk"}],"key":"MOxj6xYSoW"}],"key":"EpVrw7YJ8X"}],"visibility":"show","key":"uM75ok8igw"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"tf.random.set_seed(42)\nrandom.seed(42)\nnp.random.seed(42)\nenv = gym.make(\"CartPole-v1\")\noptimizer = keras.optimizers.Adam(learning_rate = 0.01, )\nagent = DQN(env, optimizer, epsilon=0.9, beta=0.8, batch_size=64)","key":"eiTogf1BPg"},{"type":"output","id":"esg_9TO6mNxmXPkCsJJtc","data":[],"key":"SlezDicwpv"}],"key":"xAqVf0r8Qu"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"agent.Q.summary()","key":"hUmfzxF0ua"},{"type":"output","id":"oYAPutALuHbkJKCOMmI9A","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\">Model: \"sequential_4\"</span>\n</pre>\n","content_type":"text/html"},"text/plain":{"content":"\u001b[1mModel: \"sequential_4\"\u001b[0m\n","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\nâ”ƒ<span style=\"font-weight: bold\"> Layer (type)                    </span>â”ƒ<span style=\"font-weight: bold\"> Output Shape           </span>â”ƒ<span style=\"font-weight: bold\">       Param # </span>â”ƒ\nâ”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©\nâ”‚ dense_12 (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">Dense</span>)                â”‚ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">24</span>)             â”‚           <span style=\"color: #00af00; text-decoration-color: #00af00\">120</span> â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ dense_13 (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">Dense</span>)                â”‚ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">24</span>)             â”‚           <span style=\"color: #00af00; text-decoration-color: #00af00\">600</span> â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ dense_14 (<span style=\"color: #0087ff; text-decoration-color: #0087ff\">Dense</span>)                â”‚ (<span style=\"color: #00d7ff; text-decoration-color: #00d7ff\">None</span>, <span style=\"color: #00af00; text-decoration-color: #00af00\">2</span>)              â”‚            <span style=\"color: #00af00; text-decoration-color: #00af00\">50</span> â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n</pre>\n","content_type":"text/html"},"text/plain":{"content":"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“\nâ”ƒ\u001b[1m \u001b[0m\u001b[1mLayer (type)                   \u001b[0m\u001b[1m \u001b[0mâ”ƒ\u001b[1m \u001b[0m\u001b[1mOutput Shape          \u001b[0m\u001b[1m \u001b[0mâ”ƒ\u001b[1m \u001b[0m\u001b[1m      Param #\u001b[0m\u001b[1m \u001b[0mâ”ƒ\nâ”¡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©\nâ”‚ dense_12 (\u001b[38;5;33mDense\u001b[0m)                â”‚ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m24\u001b[0m)             â”‚           \u001b[38;5;34m120\u001b[0m â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ dense_13 (\u001b[38;5;33mDense\u001b[0m)                â”‚ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m24\u001b[0m)             â”‚           \u001b[38;5;34m600\u001b[0m â”‚\nâ”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\nâ”‚ dense_14 (\u001b[38;5;33mDense\u001b[0m)                â”‚ (\u001b[38;5;45mNone\u001b[0m, \u001b[38;5;34m2\u001b[0m)              â”‚            \u001b[38;5;34m50\u001b[0m â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\"> Total params: </span><span style=\"color: #00af00; text-decoration-color: #00af00\">770</span> (3.01 KB)\n</pre>\n","content_type":"text/html"},"text/plain":{"content":"\u001b[1m Total params: \u001b[0m\u001b[38;5;34m770\u001b[0m (3.01 KB)\n","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\"> Trainable params: </span><span style=\"color: #00af00; text-decoration-color: #00af00\">770</span> (3.01 KB)\n</pre>\n","content_type":"text/html"},"text/plain":{"content":"\u001b[1m Trainable params: \u001b[0m\u001b[38;5;34m770\u001b[0m (3.01 KB)\n","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"><span style=\"font-weight: bold\"> Non-trainable params: </span><span style=\"color: #00af00; text-decoration-color: #00af00\">0</span> (0.00 B)\n</pre>\n","content_type":"text/html"},"text/plain":{"content":"\u001b[1m Non-trainable params: \u001b[0m\u001b[38;5;34m0\u001b[0m (0.00 B)\n","content_type":"text/plain"}}}],"key":"fq1v3UGs7y"}],"key":"c9UPAoRGyd"},{"type":"block","kind":"notebook-content","data":{"slideshow":{"slide_type":"subslide"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Training DQN","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YVs3Jl35Zi"}],"identifier":"training-dqn","label":"Training DQN","html_id":"training-dqn","implicit":true,"key":"YAPnHa6EeM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Below we have a routine for training our DQN","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Xs038moKVX"}],"key":"ccg47tnxL3"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Notice that we need to make sure that the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Kgngtczm97"},{"type":"inlineCode","value":"s","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"veNVbhbRop"},{"type":"text","value":" array is [1, Ns] before handing to tensorflow","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"dpQlcuWc5p"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Tensorflow expects first dimension to be for batch size and subsequent dimensions to be for data","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Qyg8B2w4N4"}],"key":"lTA1nXd5kx"}],"key":"foXomSgk6f"}],"key":"msyZmwtAef"}],"key":"RziMOGW79A"}],"visibility":"show","key":"dRM0NMt7bV"},{"type":"block","kind":"notebook-code","data":{"slideshow":{"slide_type":"subslide"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def train(dqn, N_episodes=100):\n    for episode in range(N_episodes):\n        s_, _ = dqn.env.reset()\n        s = s_[None, :]\n        step = 0\n\n        while True:\n            step += 1\n            a = dqn.act(s)\n            sp, r, done, _truncated, _ = env.step(a)\n            sp = sp[None, :]\n            r = r if (not done or step >= 200) else -r  # penalize learner when fails\n\n            dqn.remember(s, a, r, sp, done)\n            if done:\n                # if episode % 100 == 0:\n                print(f\"episode: {episode}, steps: {step}\")\n                break\n\n            # step forward in time\n            s = sp\n\n            # learn!\n            dqn.learn_replay()","visibility":"show","key":"Ug4elPsODD"},{"type":"output","id":"5-Skh-vN9lDc_SKsIQ50o","data":[],"visibility":"show","key":"Y2Dj69qWeL"}],"visibility":"show","key":"ZgvxkoDNUs"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"train(agent, 50)","visibility":"show","key":"mu9Y06ToOv"},{"type":"output","id":"oYwxlGhBBQyc46OcrEn-T","data":[{"name":"stdout","output_type":"stream","text":"episode: 0, steps: 9\nepisode: 1, steps: 9\nepisode: 2, steps: 10\nepisode: 3, steps: 10\nepisode: 4, steps: 9\nepisode: 5, steps: 10\n"},{"name":"stderr","output_type":"stream","text":"/var/folders/7d/x0yzvh3172zdzj7wsxtnhhh00000gn/T/ipykernel_81861/2317294709.py:70: DeprecationWarning: `row_stack` alias is deprecated. Use `np.vstack` directly.\n  a = np.row_stack(sarsd[1])[:, 0]\n/var/folders/7d/x0yzvh3172zdzj7wsxtnhhh00000gn/T/ipykernel_81861/2317294709.py:71: DeprecationWarning: `row_stack` alias is deprecated. Use `np.vstack` directly.\n  r = np.row_stack(sarsd[2])[:, 0]\n"},{"name":"stdout","output_type":"stream","text":"episode: 6, steps: 8\nepisode: 7, steps: 10\nepisode: 8, steps: 11\nepisode: 9, steps: 10\nepisode: 10, steps: 9\nepisode: 11, steps: 11\nepisode: 12, steps: 26\nepisode: 13, steps: 18\nepisode: 14, steps: 13\nepisode: 15, steps: 12\nepisode: 16, steps: 18\nepisode: 17, steps: 40\nepisode: 18, steps: 24\nepisode: 19, steps: 20\nepisode: 20, steps: 59\nepisode: 21, steps: 41\nepisode: 22, steps: 56\nepisode: 23, steps: 51\nepisode: 24, steps: 61\nepisode: 25, steps: 97\nepisode: 26, steps: 107\nepisode: 27, steps: 85\nepisode: 28, steps: 86\nepisode: 29, steps: 67\nepisode: 30, steps: 99\nepisode: 31, steps: 115\nepisode: 32, steps: 121\nepisode: 33, steps: 102\nepisode: 34, steps: 89\nepisode: 35, steps: 86\nepisode: 36, steps: 73\nepisode: 37, steps: 112\nepisode: 38, steps: 122\nepisode: 39, steps: 73\nepisode: 40, steps: 129\nepisode: 41, steps: 121\nepisode: 42, steps: 83\nepisode: 43, steps: 121\nepisode: 44, steps: 121\nepisode: 45, steps: 107\nepisode: 46, steps: 110\nepisode: 47, steps: 126\nepisode: 48, steps: 115\nepisode: 49, steps: 132\n"}],"visibility":"show","key":"v6ewsssREr"}],"visibility":"show","key":"MKCbRODQdQ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"After only 50 episodes our agent is regularly achieving the full 200 steps","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"STnP5pQo2c"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"We chose ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"kz27eevsbW"},{"type":"inlineMath","value":"\\epsilon=0.9","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"html":"<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>Ïµ</mi><mo>=</mo><mn>0.9</mn></mrow><annotation encoding=\"application/x-tex\">\\epsilon=0.9</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">Ïµ</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">0.9</span></span></span></span>","key":"wQPPs0y1CH"},{"type":"text","value":", so we are forcing the agent to make random decisions 10% of the time","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cZJhCaVhm3"}],"key":"tQdnbf5RH2"},{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"If we evaluate in greedy mode, we would expect to see perfect scores more often","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BcIXKNcn7x"}],"key":"xAmEI8BVcI"}],"key":"IHOvNKPkZG"}],"key":"JR8opKWvSj"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The added flexibility and generalization power we get from the MLP (relative to complete polynomial) is sufficient to succesfully complete this task!","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"oEPM2KMb3T"}],"key":"MuCubEuOkJ"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Weâ€™ll learn more about DQN and its recent exciting applications in another lecture","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pgufQpDNiW"}],"key":"Og5sfrxkax"}],"key":"gUemvWIxQo"}],"key":"yOuYCATQ3I"}],"key":"ysBarzVzjB"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Reinforcement Learning â€“ Continuous State Spaces","url":"/rl-05-continuous-s","group":"Reinforcement Learning"},"next":{"title":"Reinforcement Learning â€“ DeepMind","url":"/rl-07-deepmind","group":"Reinforcement Learning"}}},"domain":"http://localhost:3001"}